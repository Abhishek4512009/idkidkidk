<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Streamer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --sidebar-width: 240px;
            --player-height: 90px;
            --primary-color: #1db954;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --nav-height: 60px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-areas:
                "sidebar main"
                "player player";
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: 1fr var(--player-height);
        }

        /* Gradient Background */
        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(29, 185, 84, 0.15), transparent 60%);
            z-index: -1;
            animation: pulse 15s infinite alternate;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.5;
            }

            100% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            border-right: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .nav-item {
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            grid-area: main;
            overflow-y: auto;
            padding: 32px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.5) 0%, rgba(18, 18, 18, 1) 100%);
            padding-bottom: 20px;
            /* Safe area */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .search-bar {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            width: 300px;
            transition: 0.3s;
        }

        .search-bar:focus-within {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            outline: none;
            font-family: inherit;
        }

        .download-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(29, 185, 84, 0.4);
        }

        .download-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        h2 {
            margin-top: 0;
            font-size: 2rem;
        }

        /* Track List */
        .track-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .track-row {
            display: grid;
            grid-template-columns: 50px 1fr 100px;
            /* # Title Duration */
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.2s;
            align-items: center;
        }

        .track-row:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .track-row.playing {
            color: var(--primary-color);
            background: rgba(29, 185, 84, 0.1);
        }

        .track-num {
            font-size: 0.9rem;
            text-align: center;
        }

        .track-title {
            font-weight: 500;
            font-size: 1rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Player Bar */
        .player-bar {
            grid-area: player;
            background: #181818;
            border-top: 1px solid #282828;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
        }

        .now-playing {
            display: flex;
            align-items: center;
            gap: 16px;
            width: 30%;
        }

        .cover-art {
            width: 56px;
            height: 56px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #555;
            flex-shrink: 0;
        }

        .track-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        .track-name-lcd {
            font-weight: 600;
            color: #fff;
            font-size: 0.9rem;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .artist-name-lcd {
            font-size: 0.75rem;
            color: #b3b3b3;
        }

        .player-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 40%;
        }

        audio {
            width: 100%;
            height: 30px;
            margin-top: 5px;
            filter: invert(1) hue-rotate(180deg);
        }

        #status {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #333;
            display: none;
            z-index: 500;
        }

        /* Quality Label */
        .quality-label {
            width: 30%;
            text-align: right;
            font-size: 0.8rem;
            color: #888;
        }

        /* Bottom Nav (Hidden on Desktop) */
        .bottom-nav {
            display: none;
        }

        /* --- TOUCH DEVICES (Mobile & Tablet) --- */
        @media (max-width: 1024px) {
            body {
                display: block;
                /* Remove grid */
                height: 100vh;
                overflow: hidden;
                position: relative;
            }

            .sidebar {
                display: none;
                /* Hide sidebar */
            }

            .main-content {
                height: 100%;
                padding: 20px;
                padding-bottom: 160px;
                /* Space for fixed player + nav */
                width: 100%;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .search-bar {
                width: 100%;
                background: rgba(255, 255, 255, 0.1);
            }

            .download-btn {
                width: 100%;
                text-align: center;
                padding: 14px;
            }

            .track-row {
                grid-template-columns: 40px 1fr;
                /* Hide size column or simplify */
                gap: 10px;
            }

            /* Hide the file size specifically if it gets too crowded, or keep it. 
               Let's hide the 3rd column (Size) for cleaner look on small phones */
            .track-row div:last-child {
                display: none;
            }

            .track-row {
                grid-template-columns: 40px 1fr;
            }

            /* Bottom Nav */
            .bottom-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: var(--nav-height);
                background: #121212;
                border-top: 1px solid #333;
                justify-content: space-around;
                align-items: center;
                z-index: 200;
                padding-bottom: env(safe-area-inset-bottom);
            }

            .bottom-nav .nav-item {
                flex-direction: column;
                gap: 4px;
                font-size: 10px;
                color: #b3b3b3;
            }

            .bottom-nav .nav-item.active {
                color: white;
            }

            .bottom-nav .nav-item span:first-child {
                font-size: 20px;
            }

            /* Fixed Player Bar above Nav */
            .player-bar {
                position: fixed;
                bottom: var(--nav-height);
                left: 0;
                width: 100%;
                height: 80px;
                padding: 10px;
                border-top: 1px solid #282828;
                background: rgba(24, 24, 24, 0.95);
                backdrop-filter: blur(10px);
                margin-bottom: env(safe-area-inset-bottom);
            }

            .now-playing {
                width: 60%;
                gap: 10px;
            }

            .cover-art {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .player-controls {
                width: 40%;
                align-items: flex-end;
                /* Push controls right */
            }

            /* Hide full audio controls and simpler play button? 
               For now standard audio controls are tricky to style small.
               Let's keep it but make it smaller or rely on the native player's responsiveness.
            */
            audio {
                height: 30px;
                width: 100%;
                max-width: 120px;
                /* Constrain width */
            }

            .quality-label {
                display: none;
            }
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <span style="color: var(--primary-color); font-size: 32px;">&#9835;</span> Streamer
        </div>
        <ul class="nav-links">
            <li class="nav-item active">&#127968; Home</li>
            <li class="nav-item">&#128269; Search</li>
            <li class="nav-item">&#128218; Your Library</li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="header">
            <div class="search-bar">
                <span style="margin-right: 10px">&#128269;</span>
                <input type="text" id="songInput" placeholder="Search for songs...">
            </div>
            <button onclick="downloadSong()" id="dlBtn" class="download-btn">Add Song</button>
        </div>

        <div id="status"></div>

        <h2>Your Library</h2>
        <div id="loading" style="color: #888;">Loading your tracks...</div>

        <div class="track-list" id="trackList">
            <!-- Tracks injected here -->
        </div>
    </main>

    <!-- Player Bar -->
    <footer class="player-bar">
        <div class="now-playing">
            <div class="cover-art" id="currentArt">&#127925;</div>
            <div class="track-info">
                <div class="track-name-lcd" id="currentSong">No Track Selected</div>
                <div class="artist-name-lcd">Unknown Artist</div>
            </div>
        </div>

        <div class="player-controls">
            <audio id="audioPlayer" controls></audio>
        </div>

        <div class="quality-label">
            Stream Quality: High
        </div>
    </footer>

    <!-- Bottom Nav for Mobile -->
    <nav class="bottom-nav">
        <div class="nav-item active">
            <span>&#127968;</span>
            <span>Home</span>
        </div>
        <div class="nav-item">
            <span>&#128269;</span>
            <span>Search</span>
        </div>
        <div class="nav-item">
            <span>&#128218;</span>
            <span>Library</span>
        </div>
    </nav>

    <script>
        // ðŸ”´ CHANGE THIS TO YOUR RENDER URL (No trailing slash)
        const API_URL = 'https://mystream-sh78.onrender.com';

        const trackListEl = document.getElementById('trackList');
        const audioPlayer = document.getElementById('audioPlayer');
        const currentSongLabel = document.getElementById('currentSong');
        const statusEl = document.getElementById('status');
        const dlBtn = document.getElementById('dlBtn');

        // 1. Fetch List
        async function fetchTracks() {
            try {
                const res = await fetch(`${API_URL}/api/tracks`);
                const tracks = await res.json();
                document.getElementById('loading').style.display = 'none';
                trackListEl.innerHTML = '';

                tracks.forEach((track, index) => {
                    const cleanName = track.name.replace('.mp3', '');
                    const row = document.createElement('div');
                    row.className = 'track-row';
                    // Conditional HTML for size based on CSS hiding
                    row.innerHTML = `
                        <div class="track-num">${index + 1}</div>
                        <div class="track-title">${cleanName}</div>
                        <div style="text-align: right;">${(track.size / 1024 / 1024).toFixed(1)} MB</div>
                    `;
                    row.onclick = () => {
                        // Highlight logic
                        document.querySelectorAll('.track-row').forEach(r => r.classList.remove('playing'));
                        row.classList.add('playing');
                        playTrack(track);
                    };
                    trackListEl.appendChild(row);
                });
            } catch (err) {
                document.getElementById('loading').innerText = "Error loading tracks.";
                console.error(err);
            }
        }

        // 2. Play Track
        function playTrack(track) {
            currentSongLabel.innerText = track.name.replace('.mp3', '');
            audioPlayer.src = `${API_URL}/api/stream/${track.id}`;
            audioPlayer.play();
        }

        // 3. Download Logic
        async function downloadSong() {
            const songName = document.getElementById('songInput').value;
            if (!songName) return;

            showStatus(`ðŸ”Ž Searching for "${songName}"...`);
            dlBtn.disabled = true;

            try {
                const res = await fetch(`${API_URL}/api/download`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ songName })
                });

                if (res.ok) {
                    showStatus("âœ… Downloaded! Refreshing list...", 3000);
                    document.getElementById('songInput').value = "";
                    await fetchTracks();
                } else {
                    const err = await res.text();
                    showStatus(`âŒ Error: ${err}`, 5000);
                }
            } catch (error) {
                showStatus("âŒ Network Error", 5000);
            }
            dlBtn.disabled = false;
        }

        function showStatus(msg, duration) {
            statusEl.innerText = msg;
            statusEl.style.display = 'block';
            if (duration) {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, duration);
            }
        }

        fetchTracks();
    </script>
</body>

</html>